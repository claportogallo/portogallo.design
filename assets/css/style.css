:root{
  --bg:#ffffff; --dot:#e6e6e6; --ink:#0b0b0c; --muted:#686868; --line:#e9e9e9;
  --tab-bg:#000; --tab-text:#fff;
  --tab-length: 220px;    /* lunghezza del segnalibro */
  --tab-thickness: 28px;  /* larghezza (spessore) del segnalibro */
  --top-corridor: 140px;  /* fascia superiore sempre libera */
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--ink);
  background: radial-gradient(circle at 1px 1px, var(--dot) 1px, transparent 1.5px) 0 0/24px 24px, var(--bg);
  overflow:hidden; user-select:none; cursor:default;
}
.topbar.left{position:fixed; left:0; top:0; padding:18px 20px; z-index:140}
.brand a{font-weight:900; letter-spacing:1px; text-transform:uppercase; color:var(--ink); text-decoration:none}

/* Back zones */
.backzones .bz{ position:fixed; z-index:60; }
.backzones .top{ left:0; right:0; top:0; height:var(--top-corridor); }
.backzones .left{ left:0; top:var(--top-corridor); bottom:0; width:6vw; }
.backzones .right{ right:0; top:var(--top-corridor); bottom:0; width:6vw; }

/* Tabs */
.tabs.ribbon{ position:fixed; left:0; top:0; right:0; height:var(--top-corridor); z-index:130;
  display:flex; gap:12px; align-items:flex-start; justify-content:flex-end; padding:0 6vw 0 6vw; pointer-events:none; }
.vtab{ pointer-events:auto; background:var(--tab-bg); color:var(--tab-text); border:0; border-radius:0; cursor:pointer;
  width:var(--tab-thickness); height:calc(var(--tab-length) + 20px); margin-top:-20px;
  writing-mode: vertical-rl; text-orientation: mixed;
  position:relative; /* per ancorare il contenuto in basso */ }
.vtab .label{
  position:absolute; bottom:8px; left:8px; right:auto;
  transform:rotate(180deg); text-align:left; font-weight:900; letter-spacing:.4px;
}
.vtab .icon{
  position:absolute; bottom:8px; left:8px; right:auto;
  /* keep icon upright */
  writing-mode: horizontal-tb; transform:none;
  display:none;
}

.tabs.compact .vtab:not(.active){ height:72px; }
.tabs.compact .vtab:not(.active) .label{ display:none; }
.tabs.compact .vtab:not(.active) .icon{ display:block; }  /* icona ancorata in basso */
.tabs.compact .vtab:not(.active):hover{ height:calc(var(--tab-length) + 20px); }
.tabs.compact .vtab:not(.active):hover .label{ display:block; }
.tabs.compact .vtab:not(.active):hover .icon{ display:none; }

/* Contact tab: stessa "lunghezza visiva" dei segnalibri */
.contact-tab{ position:fixed; right:-160px; bottom:24px; z-index:120; background:#000; color:#fff; text-decoration:none;
  display:flex; align-items:center; height:48px; width:calc(var(--tab-length) + 80px); padding:0 16px;
  font-weight:900; text-transform:uppercase; letter-spacing:.5px; }
.contact-tab span{ margin-left:6px; }
.contact-tab:hover{ transform:translateX(-36px); }

/* Stage (home grid) */
.stage{ height:100vh; display:grid; place-items:center; padding: calc(var(--top-corridor) + 4vh) 6vw 12vh 6vw; }
.gallery.ten{ --cols:5; display:grid; grid-template-columns: repeat(var(--cols), minmax(120px, 1fr)); gap:22px; width:min(1200px, 78vw); }
@media(max-width:1100px){ .gallery.ten{ --cols:4; width:84vw; } }
@media(max-width:820px){ .gallery.ten{ --cols:2; width:90vw; } }
.card{ border:1px solid var(--line); background:#fff; cursor:pointer; transition: box-shadow .2s ease, transform .16s ease, opacity .2s ease; }
.card img{ width:100%; aspect-ratio:1 / 1; display:block; object-fit:cover; background:#fafafa; }
.card:hover{ box-shadow: 0 12px 28px rgba(0,0,0,.10), 0 2px 8px rgba(0,0,0,.06); transform: translateY(-3px); }
.card.hide{ opacity:0; transform: scale(.96); pointer-events:none; }
.card.show{ animation: cardIn .25s ease 1; }
@keyframes cardIn{ from{opacity:0; transform: scale(.96)} to{opacity:1; transform: scale(1)} }

/* Overlay: fixed layer */
.overlay{ position:fixed; inset:0; z-index:110;
  background: radial-gradient(circle at 1px 1px, var(--dot) 1px, transparent 1.5px) 0 0/24px 24px, var(--bg);
  overflow:hidden; }
.hidden{ display:none }
.close{ position:fixed; top:12px; right:12px; background:#fff; border:1px solid var(--line); width:40px; height:40px; border-radius:0; font-size:20px; cursor:pointer; z-index:150 }

/* Inner scroller sotto la fascia protetta */
.overlay-scroll{ position:absolute; left:0; right:0; top:var(--top-corridor); bottom:0; overflow:auto; padding: 0 6vw 8vh 6vw; }
.overlay-scroll::-webkit-scrollbar{ width:0; height:0; }
.overlay-scroll{ scrollbar-width:none; }

/* Project sheet */
.project-sheet .sheet{ width:min(1200px, 86vw); display:grid; grid-template-columns: 4fr 1fr; gap:24px; align-items:start; background:transparent; border:none; margin:0 auto; }
@media(max-width:1024px){ .project-sheet .sheet{ grid-template-columns:1fr; } }
.sheet-media img{ width:100%; display:block; margin:0 0 16px 0; border:1px solid var(--line); background:#fafafa; }
.sheet-meta{ position:sticky; top:24px; }
.sheet-meta h2{ margin:0 0 8px; }
.sheet-meta p{ margin:0; color:#555; }

/* Dot scrollbar */
.scroll-dots{ position:fixed; right:16px; top: calc(var(--top-corridor) + 12px); bottom: 28px; width:10px; margin:0; padding:0; list-style:none;
  display:flex; flex-direction:column; justify-content:space-between; align-items:center; z-index:145; pointer-events:none; }
.scroll-dots li{ width:6px; height:6px; border-radius:50%; background:#bfbfbf; opacity:.9; }
.scroll-dots li.active{ background:#0b0b0c; box-shadow:0 0 0 2px #0000000f; }

/* Contatti */
.contact-inner{ width:min(900px, 84vw); margin:0 auto; }
.contact-inner h2{ margin:0 0 8px; }
.contact-inner p{ margin:0 0 16px 0; color:#333; }
.map iframe{ width:100%; height:300px; border:0; }

.footnote{ position:fixed; bottom:10px; left:14px; font-size:12px; color:#888; z-index:120 }


/* micro-grow on hover for all tabs */
.vtab:hover{ height: calc(var(--tab-length) + 60px); transition: height .15s ease; }

/* compact mode: keep preview behaviour but softer grow (not full length) */
.tabs.compact .vtab:not(.active){ transition: height .15s ease; }
.tabs.compact .vtab:not(.active):hover{ height: 160px; } /* slightly longer */
.tabs.compact .vtab:not(.active):hover .label{ display:block; }
.tabs.compact .vtab:not(.active):hover .icon{ display:none; }


/* Responsive: increase corridor to prevent overlap on smaller screens,
   and slightly grow tab length for better readability */
@media (max-width: 1200px){
  :root{ --top-corridor: 160px; --tab-length: 230px; }
}
@media (max-width: 992px){
  :root{ --top-corridor: 180px; --tab-length: 240px; }
}
@media (max-width: 820px){
  :root{ --top-corridor: 200px; --tab-length: 250px; }
}
@media (max-width: 680px){
  :root{ --top-corridor: 220px; --tab-length: 260px; }
}


/* ============ Project level tweaks ============ */
/* body gets .mode-project: smaller corridor and softer hover */
body.mode-project{ --top-corridor: 110px; }
@media (max-width: 1200px){ body.mode-project{ --top-corridor: 130px; } }
@media (max-width: 992px){  body.mode-project{ --top-corridor: 150px; } }
@media (max-width: 820px){  body.mode-project{ --top-corridor: 170px; } }
@media (max-width: 680px){  body.mode-project{ --top-corridor: 190px; } }

/* In project mode keep tabs compact and limit hover grow to avoid intrusion */
body.mode-project .tabs.compact .vtab:not(.active){ height:72px; }
body.mode-project .tabs.compact .vtab:not(.active):hover{ height: 92px; } /* micro-grow only */


/* --- PRELOADER --- */
#preloader{
  position: fixed; inset: 0; z-index: 200;
  background: radial-gradient(circle at 1px 1px, var(--dot) 1px, transparent 1.5px) 0 0/24px 24px, var(--bg);
  display: grid; place-items: center;
}
#preloader.hide { opacity: 0; pointer-events: none; transition: opacity .4s ease; }
#preloader .pre-wrap{ display: grid; place-items: center; }
#preloader .pre-bar{ display: grid; grid-auto-flow: column; gap: 8px; }
#preloader .pre-bar span{
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--dot);
  animation: fillDot .3s linear forwards;
}

#preloader .pre-bar span:nth-child(1){ animation-delay: 0s; }
#preloader .pre-bar span:nth-child(2){ animation-delay: .15s; }
#preloader .pre-bar span:nth-child(3){ animation-delay: .30s; }
#preloader .pre-bar span:nth-child(4){ animation-delay: .45s; }
#preloader .pre-bar span:nth-child(5){ animation-delay: .60s; }
#preloader .pre-bar span:nth-child(6){ animation-delay: .75s; }
#preloader .pre-bar span:nth-child(7){ animation-delay: .90s; }
#preloader .pre-bar span:nth-child(8){ animation-delay: 1.05s; }
#preloader .pre-bar span:nth-child(9){ animation-delay: 1.20s; }
#preloader .pre-bar span:nth-child(10){ animation-delay: 1.35s; }
#preloader .pre-bar span:nth-child(11){ animation-delay: 1.50s; }
#preloader .pre-bar span:nth-child(12){ animation-delay: 1.65s; }
@keyframes fillDot { from{ background: var(--dot); } to{ background: #0b0b0c; } } }

/* --- STAGGERED REVEAL --- */
.gallery.ten .card {
  opacity: 0; transform: translateY(14px); will-change: transform, opacity;
}
.gallery.ten .card.is-in {
  opacity: 1; transform: translateY(0);
  transition: opacity .32s ease, transform .32s ease;
}

#preloader img{
  transform: translateY(-40px);
}

/* --- Hover overlay su card --- */
.card{ position: relative; overflow: hidden; }
.card .mask{
  position: absolute; inset: 0;
  background: rgba(255,255,255,0);  /* trasparente inizialmente */
  display: grid; place-items: center;
  opacity: 0;
  transition: opacity .18s ease, background .18s ease;
  pointer-events: none; /* non blocca il click sulla card */
}
.card:hover .mask{
  opacity: 1;
  background: rgba(255,255,255,0.5); /* bianco 50% */
}
.mask .txt{ text-align: center; padding: 10px 12px; }
.mask .title{
  font-weight: 900; color: #0b0b0c; letter-spacing: .2px;
}
.mask .meta{
  margin-top: 6px; font-size: 13px; color: #0b0b0c; opacity: .85;
}

/* Evita linee durante il caricamento immagini nella scheda progetto */
:root{ --frame: #d7d7d7; } /* colore bordo (puoi regolarlo) */

#sheetMedia img{
  display:block;
  width:100%;
  height:auto;
  border:6px solid transparent;   /* niente bordo finché non è pronta */
  opacity:0;                       /* invisibile finché non è pronta */
  transition: opacity .2s ease;
  background:#fff;                 /* evita flash grigio dietro */
}

#sheetMedia img.is-ready{
  opacity:1; 
  border-color: var(--frame);      /* mostra il bordo solo quando pronta */
}


/* ===== Responsive & Mobile — v6 CONSOLIDATA ===== */

/* Base desktop + tablet grande */
.gallery.ten{ display:grid; grid-template-columns: repeat(5, 1fr); gap: var(--gap, 22px); }
.card{ position:relative; aspect-ratio: 1/1; overflow:hidden; }
.card img{ width:100%; height:100%; object-fit:cover; display:block; }
@media (max-width:1200px){ .gallery.ten{ grid-template-columns: repeat(4,1fr); } }

/* ===== Tablet/Mobile ===== */
@media (max-width:900px){
  :root{
    --gap: 18px;
    --headerH: clamp(64px, 9vw, 110px);
    /* Tabs */
    --tabW: 88px;     /* larghezza linguetta (stretta) */
    --tabGap: 4px;    /* distanza tra linguette */
    --tabOffset: -12px; /* sporgenza a destra (negativo = fuori) */
  }

  /* Griglia a 3 colonne */
  .gallery.ten{ grid-template-columns: repeat(3, 1fr); }

  /* Header fisso, logo a SINISTRA, fascia TRASPARENTE; z-order sotto il preloader */
  header.topbar{
    position:fixed; top:0; left:0; right:0; z-index:190 !important;
    height:var(--headerH);
    display:flex; align-items:center; justify-content:flex-start;
    background:transparent; padding-left:12px;
  }
  header.topbar .logo-img{ height:clamp(56px, 14vw, 112px); display:block; }

  /* Contenuti sotto header (solo home) */
  .stage{
    padding-top: calc(var(--headerH) + 16px);
    padding-left: 6vw; padding-right: 6vw; padding-bottom: 12vh;
  }

  /* Sblocco scroll */
  html,body{ height:auto; overflow:auto; }
  body.no-scroll{ overflow:hidden; }

  /* Overlay sotto al logo */
  .overlay{ z-index:180 !important; }

  /* ===== TABS a pettine a destra ===== */
  #tabs{
    position:fixed;
    top: calc(var(--headerH) + 8px);
    right: var(--tabOffset); left:auto;
    z-index:180;
    display:flex; flex-direction:column; align-items:flex-end;
    gap: var(--tabGap);
    padding:0; background:transparent; overflow:visible;
    height:auto; width:auto;
  }
  .vtab{
    writing-mode: horizontal-tb !important; transform:none !important;
    display:inline-flex; align-items:center; justify-content:flex-start;
    width: var(--tabW); height:40px; padding:0 12px;
    text-align:left; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    border-radius:4px 0 0 4px;
    background:#000; color:#fff;
    transition: none !important;            /* niente animazioni/grow */
  }
  .vtab .icon{ display:none !important; }   /* niente icone in home */
  .vtab .label{ display:block; font-weight:700; }

  /* fallback se il browser ignorasse gap */
  .vtab + .vtab{ margin-top: var(--tabGap); }

  /* Modalità compatta: l’attivo resta identico, gli altri diventano icona */
  #tabs.compact .vtab.active{
    width: var(--tabW) !important; padding:0 12px !important;
  }
  #tabs.compact .vtab:not(.active){
    width: 36px !important; padding:0 !important; justify-content:center !important;
  }
  #tabs.compact .vtab:not(.active) .label{ display:none !important; }
  #tabs.compact .vtab:not(.active) .icon{ display:inline !important; }

  /* “Contatti” in basso, stessa misura e sporgente */
  #contactTab{
    position:fixed; right:var(--tabOffset); bottom:12px; z-index:180;
    display:flex; align-items:center; justify-content:flex-start;
    width:var(--tabW); height:40px; padding:0 12px;
    border-radius:4px 0 0 4px; background:#000; color:#fff; text-decoration:none;
    border:0; box-shadow:none; font-size:12px; line-height:1;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  /* ===== Dentro un progetto: nessuna fascia di rispetto sopra ===== */
  #overlay:not(.hidden) .overlay-scroll,
  #overlay:not(.hidden) #overlayScroll{
    padding-top: 0 !important;
  }
  #overlay .project-sheet,
  #overlay .sheet,
  #overlay .sheet-media{ margin-top:0 !important; }

  /* Niente X: chiusura via swipe (gestita da JS) */
  #closeOverlay{ display:none !important; }
}

/* ===== Smartphone ===== */
@media (max-width:640px){
  :root{ --gap:14px; --headerH:96px; }
  .gallery.ten{ grid-template-columns: repeat(2,1fr); }
  .stage{ padding-top: calc(var(--headerH) + 16px); padding-left:12px; padding-right:12px; }
  #overlayScroll{ padding-left:12px; padding-right:12px; }
  #preloader img.logo-pre{ transform: translateY(-20px); }
}

/* ===== Smartphone molto piccolo ===== */
@media (max-width:380px){
  .gallery.ten{ grid-template-columns:1fr; }
}

/* ===== Nascondi tabs quando non devono vedersi ===== */
/* Durante il preloader (vale sempre) */
#preloader:not(.hide) ~ #tabs,
#preloader:not(.hide) ~ #contactTab{ display:none !important; }
/* Dentro un progetto su mobile */
@media (max-width:900px){
  body:has(#overlay:not(.hidden)) #tabs,
  body:has(#overlay:not(.hidden)) #contactTab{ display:none !important; }
}
